---
apiVersion: v1
kind: ConfigMap
metadata:
  name: authentik-values
  namespace: authentik
data:
  values.yaml: |
    global:
      deploymentAnnotations:
        vault.hashicorp.com/agent-inject: 'true'
        vault.hashicorp.com/role: 'authentik-reader'
        vault.hashicorp.com/agent-inject-secret-secret-key.txt: 'authentik/secret-key/secret-key'
    authentik:
      secret_key: file:///vault/secrets/secret-key.txt
      postgresql:
        host: authentik-rw.authentik
        user: file:///postgres-creds/username
        password: file:///postgres-creds/password
    server:
      serviceAccountName: authentik-reader
      ingress:
        ingressClassName: traefik
        enabled: true
        hosts:
        - authentik.local.m1xxos.tech
        tls:
        - secretName: local-m1xxos-tech
          hosts:
          - authentik.local.m1xxos.tech
      volumes:
      - name: postgres-creds
        secret:
          secretName: authentik-app
      volumeMounts:
      - name: postgres-creds
        mountPath: /postgres-creds
        readOnly: true
    worker:
      serviceAccountName: authentik-reader
      volumes:
      - name: postgres-creds
        secret:
          secretName: authentik-app
      volumeMounts:
      - name: postgres-creds
        mountPath: /postgres-creds
        readOnly: true
    redis:
      enabled: true
