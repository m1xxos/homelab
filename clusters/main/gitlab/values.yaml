apiVersion: v1
kind: ConfigMap
metadata:
  name: gitlab-values
  namespace: gitlab
  labels:
    reconcile.fluxcd.io/watch: Enabled
data:
  values.yaml: |
    global:
      edition: ce
      hosts:
        domain: gl.m1xxos.tech
        gitlab:
          name: gl.m1xxos.tech
          https: true
        registry:
          name: registry.gl.m1xxos.tech
          https: true
        kas:
          name: kas.gl.m1xxos.tech
        pages:
          name: pages.gl.m1xxos.tech
          https: true
        ssh: gl.m1xxos.tech
      ingress:
        enabled: true
        configureCertmanager: false
        provider: traefik
        tls:
          enabled: true
          secretName: gl-m1xxos-tech
      gatewayApi:
        enabled: true
        installEnvoy: false
        gatewayRef:
          name: "traefik-gateway"
          namespace: "traefik"
          sectionName: "websecure"
        listeners:
          gitlab-web:
            tls:
              mode: Terminate
              certificateRefs:
                - name: local-m1xxos-tech
          gitlab-ssh:
            protocol: "TCP"
          registry-web:
            tls:
              mode: Terminate
              certificateRefs:
                - name: gl-m1xxos-tech
          pages-web:
            tls:
              mode: Terminate
              certificateRefs:
                - name: gl-m1xxos-tech
          kas-web:
            tls:
              mode: Terminate
              certificateRefs:
                - name: gl-m1xxos-tech
          kas-workspaces-web:
            tls:
              mode: Terminate
              certificateRefs:
                - name: gl-m1xxos-tech
          kas-registry-web:
            tls:
              mode: Terminate
              certificateRefs:
                - name: gl-m1xxos-tech
      time_zone: "Europe/Moscow"
      redis:
        host: dragonfly-gl
        port: 6379
        auth:
          enabled: true
          secret: dragonfly-gl
          key: password
      psql:
        host: gitlab-rails-db-rw
        password:
          secret: gitlab-rails-db-app
          key: password
      minio:
        enabled: false
      registry:
        bucket: registry
      pages:
        enabled: true
        objectStore:
          enabled: true
          bucket: gitlab-pages
          connection:
            secret: gitlab-object-storage
            key: config
      appConfig:
        object_store:
          enabled: true
          connection:
            secret: gitlab-object-storage
            key: config
    redis:
      install: false
    postgresql:
      install: false
    gitlab:
      gitaly:
        persistence:
          size: 10Gi
      toolbox:
        backups:
          objectStorage:
            config:
              secret: gitlab-object-storage
              key: s3cmd
      webservice:
        workerProcesses: 1
    installCertmanager: false
    nginx-ingress: &nginx-ingress
      enabled: false
    prometheus:
      install: false
